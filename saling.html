<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="build/kalendae.standalone.js"></script>
    <link rel="stylesheet" href="build/kalendae.css".css">
    <style type="text/css" media="screen">
	li{list-style: none;}
		*{
			margin:0px;
			padding:0px;
		}
		#tab{
			position: relative;
			width: 600px;
			height: 400px;
			margin:50px auto;
			border: 1px solid #ccc;
		}
		.list_nav{
			float: left;
			width: 199px;
			height: 50px;
			border-right: 1px solid red;
			background-color: #eee;
			text-align: center;
			line-height: 50px;
		}
		.active{
			background-color: red;
		}
		.tab_nav{
			display: none;
			position: absolute;
			top:50px;
			width: 100%;
			height: 350px;
		}
		.on{
			display: block;
        }
    
    </style>
    
</head>
<body>
    <div class="main">
        <div class="left"></div>
        <div class="right">
            <div class="title"></div>
            <div class="subtitle"></div>
            <p class="normalWord">红色畅销价</p>
            <div class="price"></div>
            <div class="protect"></div>
            <p class="normalWord">月销量</p> 
            <p class="normalWord">游玩日期</p>
            <div class="date"> 
              请选择游玩日期
            </div>
            <p class="normalWord">月销量</p> 
            <div class="buyNow">立即预订</div>
        </div>
        <div class="buttomTip">
                <p class="normalWord">营运商：红色文化园</p> 
                <p>服务评分<img src="img/star.png" alt="">4.94</p>
                <div class="firstLogo"></div>
                <p class="normalWord">服务热线：</p>
                <p class="number">400-000-000</p>
                <div class="secondLogo"></div>
                <p class="normalWord">工作时间：</p>
                <p class="number">00:00:00-23:00:00</p>
        </div>
        <div class="buttomMain">
                <div id="tab">
                        <ul class="list">
                            <li class="list_nav active">使用说明</li>
                            <li class="list_nav">费用说明</li>
                            <li class="list_nav">入园信息</li>
                        </ul>
                        <ul class="tab">
                            <li class="tab_nav on">
                                    可参观时间：8:00—22:00（10月）
                            </li>
                            <li class="tab_nav">
                                    大青山地区的和平解放专场门票1张，一杯盖碗茶。
                            </li>
                            <li class="tab_nav"> 凭发送的电子票，在前门西大街正阳市场三号楼老舍茶馆一楼票台换票，直接入园。

                            </li>
                        </ul>
               
        </div>
    </div>
    <script type="text/javascript">
     window.onload=function(){
            let swiper = document.querySelector(".swiper"),
                pre = swiper.querySelector(".pre"),
                next = swiper.querySelector(".next"),
                _ul = swiper.querySelector(".imgBox"),//图片ul
                ali = _ul.querySelectorAll('li'),
                aImg = swiper.querySelectorAll("li img"),
                imgW = aImg[0].offsetWidth,//需要window.onload
                index = 1,//计算滚动到哪张图片
                isTransitioned = true,//判断动画是否已完成
                item = swiper.querySelector('.item');
            
            //克隆第一张图片，添加到图片队列的最后面
            let cloneLi = ali[0].cloneNode(true);
            _ul.appendChild(cloneLi);
            //克隆最后一张图片，添加到图片队列的最前面
            let cloneLastLi = ali[ali.length-1].cloneNode(true);
                //插入方法1：
//              _ul.insertBefore(cloneLastLi,ali[0]);
                //插入方法2
            _ul.prepend(cloneLastLi);
            
            //点击右边按钮
            next.addEventListener("click",()=>{
                if(isTransitioned){
                    index++;//先++再设置
                    move();
                    fenyeq(index);  
                }
            })
            
            
            //初始化图片队列：
            _ul.style.transform="translateX("+(-imgW*index)+"px)";
            //点击左边按钮
            pre.addEventListener("click",()=>{
                if(isTransitioned){
                    index--;
                    move();
                    fenyeq(index);
                }
            })
            
            setInterval(function(){
                if(isTransitioned){
                    index++;
                    move();
                    fenyeq(index);
                }
            },4000)
            
            //监听动画结束
            _ul.addEventListener("transitionend",()=>{//给ul加了transi
                if(index == aImg.length+1){//边界判断
                    index = 1;
                    _ul.classList.toggle("transi");//移除ul的transi
                    _ul.style.transform="translateX("+(-imgW*index)+"px)";//瞬间变回第一张
                }
                if(index==0){
                    index=aImg.length;
                    _ul.classList.toggle("transi");//移除ul的transi
                    _ul.style.transform="translateX("+(-imgW*index)+"px)";//瞬间变回第一张
                }
                isTransitioned = true;//每次动画结束都判断
            })
            
            
            //根据图片的张数生成分页器
            for(let i=0;i<aImg.length;i++){
                var newLi = document.createElement('li');
                item.appendChild(newLi);
            }
            //第一个小圆点添加样式
            item.children[0].classList.add('active');
            //给分页器添加点击事件
            for(let j=0;j<item.children.length;j++){
                    item.children[j].addEventListener('click',()=>{
                        for(let q=0;q<item.children.length;q++){
                            item.children[q].classList.remove('active');
                        }
                        item.children[j].classList.add('active');
                        index = j+1;
                        _ul.classList.add('transi');
                        _ul.style.transform="translateX("+(-imgW*index)+"px)";
                    })
                }
            //点击左右按钮分页器跟随
            function fenyeq(index){
                for(let k=0;k<item.children.length;k++){
                    item.children[k].classList.remove('active');
                }
                index = index -1;
                index = index==item.children.length?0:index;//左按钮边界
                index = index<0?item.children.length-1:index;//右按钮边界
                item.children[index].classList.add('active');
            }
            
            function move(){
                _ul.classList.add("transi");
                _ul.style.transform="translateX("+(-imgW*index)+"px)";
                isTransitioned = false;
            }
    }

        
        new Kalendae(document.body,{
            months:1,
            mode:'single',
            selected:Kalendae.moment().subtract({M:1})
        });
        var aList=document.getElementsByClassName("list_nav"),
			aTab=document.getElementsByClassName("tab_nav"),
			index=0; //用来存储上一次的值
		for(var i=0;i<aList.length;i++){
			//闭包加函数自执行
			(function(i){
				aList[i].onclick=function(){
					aList[index].classList.remove("active");
					aTab[index].classList.remove("on");
					index=i;
					aList[index].classList.add("active");
					aTab[index].classList.add("on");
				}
			})(i);
		}

        </script>
</body>
</html>